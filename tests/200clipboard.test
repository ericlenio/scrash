# vim:filetype=bash
-clear-cache
len=15
r=$(-random-string $len)
[ $len = ${#r} ]
echo $r | -set-clipboard
if -ws /scr-get-clipboard --compressed 2>/dev/null; then
  echo "access to clipboard without a OTP: expected HTTP 401" >&2
  false
fi
r2=$(-get-clipboard)
[ $r = $r2 ]
# check that when copying from stdin that the last \n is chopped off
t0=$SCR_TMPDIR/t0
-get-clipboard > $t0
IFS= read -d '' ans <$t0 || true
[ "$ans" = "${ans%$'\n'}" ]
# test copy a file
-set-clipboard /etc/passwd
[ $(-get-clipboard | -md5) = $(-md5 /etc/passwd) ]
# clipboard over ssh
t=$(mktemp)
uname -a > $t
-ssh-localhost -set-clipboard $t
[ $(-md5 $t) = $(-get-clipboard | -md5) ]
rm $t
echo $r | -set-clipboard
r2=$(-get-clipboard)
[ $r = $r2 ]
# test file name containing a space
t2="$SCR_TMPDIR/my file"
uname -a > "$t2"
-set-clipboard "$t2"
[ "$(-get-clipboard)" = "$(uname -a)" ]
paste_prog=$(node << 'EOF'
import("./src/js/Server.js").then(module=>{
const Server=module.default;
const s=new Server();
console.log(s.getOsProgram("PASTE").join(' '));
})
EOF
)
[ "$paste_prog" ]
[ "$($paste_prog)" = "$(uname -a)" ]

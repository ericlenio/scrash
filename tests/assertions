# vim:filetype=bash
SCR_TEST_ASSERTIONS=(
  # basic
  '-test-group BASIC'
  '[ $SCR_TEST_GROUP = BASIC ]'
  '[[ $SCR_PORT =~ ^[0-9]+$ ]]'
  'len=8'
  'v=$(-random-string $len)'
  '[ $len = ${#v} ]'
  '-ws-hello-world >/dev/null'
  '-ws-hello-world | grep -q "hello world"'
  'session_id=$(screen --generate-session-id)'
  '[ ${#session_id} -gt 0 ]'
  '[[ $session_id =~ ^[-[:alnum:]]+$ ]]'
  '[ -d $SCR_TMPDIR ]'
  '[ $SCR_ENV = test ]'

  # vim
  '-test-group VIM'
  '[ ${#EDITOR} -gt 0 ]'
  'v --version >/dev/null'
  '[ -e $EDITOR ]'
  'rm $EDITOR'
  'v --version >/dev/null'
  '[ -e $EDITOR ]'
  'echo ok | -copy-to-clipboard'
  '[ ok = $(-clipboard) ]'
  't1=$SCR_TMPDIR/t1'
  'printf "/^root\015ve\003:q\015" > $t1'
  'v -s $t1 /etc/passwd'
  'rm $t1'
  '[ root = $(-clipboard) ]'

  # start/stop gnu screen
  '-test-group SCREEN'
  'screen -S $session_id -d -m'
  'screen -ls | grep -q $session_id'
  'screen -S $session_id -X quit'
  '! screen -ls | grep -q $session_id'

  'SCR_TEST_STY=$(screen --generate-session-id)'
  'screen -S $SCR_TEST_STY -d -m'
  'screen -ls | grep -q $SCR_TEST_STY'
  '-test-sty-launch $SCR_TEST_STY'
  'screen -S $SCR_TEST_STY -X quit'
  '! screen -ls | grep -q $SCR_TEST_STY'

  # ssh
  '-test-group SSH'
  'h=$(-ssh-localhost hostname)'
  '[ $h = $(hostname) ]'
  # remote SCR_PORT from ssh session should always be different from parent shell
  'remote_port=$(eval $(-ssh-localhost declare -p SCR_PORT); echo $SCR_PORT)'
  '[ $remote_port != $SCR_PORT ]'
  '[[ $remote_port =~ ^[0-9]+$ ]]'

  # md5
  '-test-group MD5'
  's="hello world"'
  't=$(mktemp) && echo "$s" > $t'
  '[ $(-md5 $t) = 6f5902ac237024bdd0c176cb93063dc4 ]'
  '[ $(echo "$s" | -md5) = 6f5902ac237024bdd0c176cb93063dc4 ]'
  '! -md5 /no-such-file'
  'rm $t'

  # clipboard
  '-test-group CLIPBOARD'
  'len=8'
  'r=$(-random-string $len)'
  '[ $len = ${#r} ]'
  'echo -n $r | -copy-to-clipboard'
  'r2=$(-clipboard)'
  '[ $r = $r2 ]'
  '-copy-to-clipboard /etc/passwd'
  '[ $(-clipboard | -md5) = $(-md5 /etc/passwd) ]'

  # clipboard over ssh
  't=$(mktemp) && uname -a > $t'
  '-ssh-localhost -copy-to-clipboard $t'
  '[ $(-md5 $t) = $(-clipboard | -md5) ]'
  'rm $t'
)

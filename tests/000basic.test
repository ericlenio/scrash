# vim:filetype=bash
-clear-cache
-ws-about | grep scrash
-ws-about -H "Accept: text/json" | node -r fs -e 'const s=JSON.parse(fs.readFileSync(0,"utf8"));console.log(s.appName)'
! -ws /scr-no-such-endpoint
[[ $SCR_PORT =~ ^[0-9]+$ ]]
len=100
v=$(-random-string $len)
[ $len = ${#v} ]
[ "$EDITOR" ]
-ws-hello-world | grep -q "hello world"
# make sure curl web service calls properly ignores proxies that might
# typically exist in $HOME/.curlrc
curlrc="$SCR_TMPDIR/.curlrc"
echo "proxy = http://no-such-host.example.private:8181" > "$curlrc"
CURL_HOME=$(dirname "$curlrc") bash -c -- -ws-hello-world
bootstr=$(-shell-boot-string $SCR_PORT hostname)
h=$(CURL_HOME=$(dirname "$curlrc") bash -c "$bootstr")
[ "$h" = $(hostname) ]
session_id=$(screen --generate-session-id)
[ ${#session_id} -gt 0 ]
[[ $session_id =~ ^[-[:alnum:]]+$ ]]
[ -d $SCR_TMPDIR ]
[ $SCR_ENV = test ]
# md5 testing
s="hello world"
t=$(mktemp)
[ "$t" ]
echo "$s" > $t
[ -s "$t" ]
[ $(-md5 $t) = 6f5902ac237024bdd0c176cb93063dc4 ]
[ $(echo "$s" | -md5) = 6f5902ac237024bdd0c176cb93063dc4 ]
! -md5 /no-such-file
rm $t
# ssh
h=$(-ssh-localhost hostname)
[ $h = $(hostname) ]
remote_port=$(eval $(-ssh-localhost declare -p SCR_PORT); echo $SCR_PORT)
[ $remote_port != $SCR_PORT ]
[[ $remote_port =~ ^[0-9]+$ ]]
scr_env2=$(-ssh-localhost bash -c 'echo $SCR_ENV')
[ "$scr_env2" = $SCR_ENV ]
scr_env2=$(-s nobody bash -c 'echo $SCR_ENV')
[ "$scr_env2" = $SCR_ENV ]
u=$(-ssh-localhost bash -c -- "uname -a")
[ "$u" = "$(uname -a)" ]
a=$(-ssh-localhost bash -c -- 'a=asdf;echo $a')
[ $a = asdf ]
-psg node | grep -w $SCR_PORT
-psg -w node | grep -w $SCR_PORT
! -psg -kp 2>/dev/null
pids=($(-psg -pw node))
[ ${#pids[@]} -gt 0 ]
for pid in ${pids[@]}; do
  [[ "$pid" =~ ^[0-9]+$ ]]
done

# scrash
gnu screen and bash shell framework

# Architecture
There is a nodejs server and a bash shell client. The bash shell is customized
by the existence of a user profile subdirectory under the `profile` directory
of this project. By default, the server picks the profile that matches the
username of the server daemon process.

# Supported operating systems
Tested on Darwin (Mac), Linux, Raspian (Raspberry Pi), and OpenBSD. Almost
certainly would be fine with FreeBSD.

# Vim
Put any desired vimrc settings in `./profile/MYPROFILE/vimrc` and they will be
used for all vim sessions. If you want to use scrash's OS clipboard integration
then add this to your vimrc file:

    set runtimepath+=$SCR_VIMRUNTIME

Copying to the OS clipboard is achieved by calling function `ScrSetClipboard`;
pasting from the clipboard is achieved with function `ScrPasteClipboard`. I
like to use ctrl-c to copy whatever is currently highlighted in Visual mode,
and ctrl-v to paste, like this:

    vnoremap <c-c> y:call ScrSetClipboard()<cr>
    nnoremap <c-v> :call ScrPasteClipboard()<cr>

# ssh
There are drop in replacement bash functions provided for ssh, scp, sftp, and
ssh-add. They have logic to contact ssh-agent by a single-use http proxy, with
each use requiring a one time password (OTP) generated by the server. Each time
one of the ssh functions is called, an OTP is pasted into the OS clipboard and
the user must paste it into the terminal window (after being prompted) to
proceed with the ssh-agent http proxy.

# Testing
Test cases are found in `./tests/*.test`, and they are just bash scripts that
get executed with shell options `set -o errexit -o errtrace` enabled, meaning
that if any statement in any of these bash scripts finishes with a non-zero
return value then that is considered a failure and testing is immediately
stopped.

Tests are executed in several ways:

    # run all tests
    npm test
    # run all tests with a custom profile
    npm test -- -P MYPROFILE
    # run all tests with test files that match (glob style) on "basic"
    npm test -- -g basic
    # same as above, but also include test files that match on "vim"
    npm test -- -g "basic vim"

If the last line of output is `SUCCESS`, then all test cases (in theory) were
successful.

# Running
Run `./scrash` to start both the server and client inside a new gnu screen
session.

Run `./scrash -h` for other command line options.
